# 代码质量（vscode）

## eslint

eslint 为了保证代码质量和风格

### 安装

```bash
npm i -D eslint
```

### 生成配置文件

```bash
npx eslint --init
```

运行命令，选择相应的配置项，这个命令做了两步

1.生成.eslintrc.js 配置文件，根据你的选项不同会有略微出入

```js
module.exports = {
  root: true, // 限定配置文件使用范围
  env: {
    // 指定代码运行环境
    browser: true, // browser global variables
    es2021: true, //
  },
  parserOptions: {
    ecmaVersion: "latest", //ECMAScript 版本
    sourceType: "module", //ECMAScript 模块
  },
  // 继承第三方风格
  extends: [
    "airbnb-base", // 全名eslint-config-airbnb-base，可省略eslint-config
  ],
  rules: {},
};
```

2.下载对应的第三方 eslint 配置，我选的 airbnb 风格的，所以下了 eslint-config-airbnb-base，而 eslint-config-airbnb-base 依赖于 eslint-plugin-import

### 代码检查

```bash
npx eslint ./需要检查语法的文件路径
```

### 配置编辑器

有了 eslint，但只有运行命令的时候才会显示错误，所以为了方便我们开发，vscode 安装插件 ESlint，这个时候就能直接看到文件的报错了，就不用去运行命名了

### 增加.eslintignore 忽略文件

增加忽略文件，忽略一些文件不进行 eslint 检查

.eslintignore

```conf
# 以”#”号开头表示注释；
# 以斜杠“/”开头表示目录；
# 以星号“*”通配多个字符；
# 以问号“?”通配单个字符
# 以方括号“[]”包含单个字符的匹配列表；
# 以叹号“!”表示不忽略(跟踪)匹配到的文件或目录；

# *.txt  ，*.xls  表示过滤某种类型的文件
# target/ ：表示过滤这个文件夹下的所有文件
# /test/a.txt ，/test/b.xls  表示指定过滤某个文件下具体文件
# !*.java , !/dir/test/     !开头表示不过滤
# *.[ab]    支持通配符：过滤所有以.a或者.b为扩展名的文件
# /test  仅仅忽略项目根目录下的 test 文件，不包括 child/test等非根目录的test目录

/dist
/build
```

### 打包进行 eslint 检查

安装

```bash
npm i -D eslint eslint-webpack-plugin eslint-config-airbnb-base eslint-plugin-import
```

webpack.config.js 配置

```js
const ESLintPlugin = require("eslint-webpack-plugin");

module.exports = {
  plugins: [new ESLintPlugin()],
};
```

## stylelint

安装

```bash
npm i -D stylelint stylelint-config-standard stylelint-prettier stylelint-config-prettier
npm i -D stylelint-less stylelint-config-recommended-less postcss-less
```

增加.stylelintrc.js

```js
module.exports = {
  plugins: ["stylelint-prettier"],
  extends: [
    "stylelint-config-standard",
    "stylelint-config-recommended-less",
    "stylelint-config-prettier",
  ],
  customSyntax: "postcss-less",
  rules: {
    "prettier/prettier": true,
  },
};
```

## Prettier

ESLint 主要负责处理两种规则：格式化和代码质量问题。格式化不是它的强项，需要用 Prettier 格式化大师来处理代码风格有问题的代码。

Prettier 格式化后的代码，理论上是最好看的。正因为 Prettier 只关注格式化，所以它也可以格式化其它的文件。

安装

```bash
npm i -D prettier
```

增加配置文件
.prettier.js

```js
module.exports = {};
```

编辑器安装 Prettier -code formatter 插件，可以一键格式化文档

编辑器 settings.josn 增加配置，保存的时候格式化

```json
"editor.formatOnSave": true, //开启自动保存
"editor.defaultFormatter": "esbenp.prettier-vscode", //默认格式化工具选择prettier
```

## eslint 和 prettier 配合使用

prettier 是擅长代码格式的校验，eslint 擅长代码质量的校验。虽说 eslint 也能格式校验，但是并没有 prettier 那么强势。

当你用 Prettier 格式化代码后再用 ESLint 去检测，会出现一些因为格式化导致的 warning。

eslint-plugin-prettier 插件会调用 prettier 对你的代码风格进行检查，其原理是先使用 prettier 对你的代码进行格式化，然后与格式化之前的代码进行对比，如果过出现了不一致，这个地方就会被 prettier 进行标记,最后 eslint 自动 fix 按照 prettier 的规范修复 error 代码

安装

```bash
npm i eslint-plugin-prettier eslint-config-prettier -D
```

.eslintrc.js

```js
extends: ["airbnb-base", "plugin:prettier/recommended"],
```

有时候配置好后重启 vscode 才能生效

### 方便开发（vscode）

增加配置文件

在项目根目录下

## 编辑器配置

```
{
  "editor.formatOnSave": true, //开启保存的时候格式化
  "eslint.enable": true, //是否开启vscode的eslint
  "eslint.alwaysShowStatus": true, //右下角显示eslint图标
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true // 在保存的时候用eslint修复和prettier不冲突部分错误
  },
  "editor.defaultFormatter": "esbenp.prettier-vscode", //默认格式化工具选择prettier
}
```

## .editorconfig

添加 .editorconfig 文件,编辑器配置文件。.editorconfig 配置文件用于抹平不同编辑器或系统之间的编码差异，放在项目根目录。最常见的配置之一是 end_of_line = lf，如果用 Windows 和 Mac 混合开发，不统一行尾符会造成 eslint 爆红。

由于不同开发者的编辑器设置不同，故在项目中应当包含 .editorconfig，用来统一配置编辑器的换行、缩进存储格式。

配置

```
# http://editorconfig.org
root = true

[*]
indent_style = space                    # 输入的 tab 都用空格代替
indent_size = 2                         # 一个 tab 用 2 个空格代替
end_of_line = lf                      # 换行符使用 unix 的换行符 \n
charset = utf-8                         # 字符编码 utf-8
trim_trailing_whitespace = true         # 去掉每行末尾的空格
insert_final_newline = true             # 每个文件末尾都加一个空行

[*.md]
trim_trailing_whitespace = false        # .md 文件不去掉每行末尾的空格
```
